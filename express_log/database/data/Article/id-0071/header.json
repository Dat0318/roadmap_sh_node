{
  "@id": "0071",
  "title": "Bài 3 - Điều Hướng Cơ Bản",
  "short-title": "Bài 3 - Điều Hướng Cơ Bản",
  "category-id": "09",
  "keywords": "lập trình web, hướng dẫn cơ bản, javascript, nodejs, expressjs",
  "content": "Trong bài viết này, chúng ta sẽ cùng thảo luận về việc điều hướng các yêu cầu nhận được và tạo ra các tuyến xử lý `route` trong ExpressJS. Hãy cùng xuất phát với các phương thức gửi yêu cầu cơ bản.\r\n\r\n## Các Phương Thức Gửi Yêu Cầu Của Trình Duyệt Web\r\n\r\nNếu như bạn tới với Sub-Series ExpressJS từ đâu đó khác thì bạn có thể bỏ qua phần này. Còn trong trường hợp bạn đã đồng hành cùng mình từ đầu [Series Tự Học Lập Trình Web Một Cách Tự Nhiên](/) thì đây là phần thông tin khá quan trọng mà mình đã không giới thiệu trong các Sub-Series trước vì chưa có trường hợp ứng dụng.\r\n\r\nTrên thực tế thì các yêu cầu gửi từ trình duyệt web tới máy chủ có thể được chia thành nhiều loại với những ý nghĩa biểu thị khác nhau và được MDN liệt kê tại đây - [Các phương thức gửi yêu cầu qua HTTP](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods).\r\n\r\nTuy nhiên thông thường thì sẽ chỉ có 4 phương thức chính, tương ứng với các thao tác phổ biến mà chúng ta muốn thực hiện trên một cơ sở dữ liệu `database` là:\r\n\r\n- [GET](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET) yêu cầu một bản trình bày dữ liệu từ `database`.\r\n- [POST](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST) gửi một gói dữ liệu tới để yêu cầu thêm vào `database`.\r\n- [PUT](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT) yêu cầu tạo mới hoặc cập nhật một gói dữ liệu tại `database`.\r\n- [DELETE](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/DELETE) yêu cầu xóa một gói dữ liệu tại `database`.\r\n\r\nPhương thức đầu tiên `GET` là phương thức phổ biến nhất và gắn liền với nhiều thao tác cơ bản khi sử dụng trình duyệt web. Cụ thể là khi chúng ta gõ một địa chỉ URL vào thanh địa chỉ của trình duyệt web, hoặc khi chúng ta nhấn vào một liên kết, đó chính là thao tác gửi yêu cầu bằng `GET` để được xem một bản trình bày dữ liệu. Đây cũng là phương thức mặc định của các biểu mẫu nhập liệu khi được nhấn nút gửi đi.\r\n\r\nPhương thức thứ hai là `POST` - như chúng ta đã biết - có thể được sử dụng khi chúng ta chỉ định thuộc tính `method` cho một phần tử `<form>`.\r\n\r\n```post.html\r\n<form method=\"post\" action=\"/login\">\r\n   Tài khoản: <input type=\"text\" name=\"username\">\r\n   Mật khẩu: <input type=\"password\" name=\"password\">\r\n   <button type=\"submit\">Đăng nhập</button>\r\n</form>\r\n```\r\n\r\nBên cạnh đó, các phương thức `POST`, `PUT`, và `DELETE`, có thể được gửi qua code JavaScript bằng [XMLHTTPRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest).\r\n\r\n## Các phương thức định tuyến\r\n\r\nĐể định nghĩa một tuyến `route` xử lý yêu cầu trong ExpressJS, chúng ta có thể sử dụng cú pháp cơ bản là `app.method(path, handler)`. Trong đó `method` là tên của các phương thức gửi yêu cầu nói ở phần trước, và `path` là điểm dừng `endpoint` để kích hoạt hàm xử lý yêu cầu `handler`.\r\n\r\n```app.js\r\napp.get(\"/\", function(request, response) {\r\n   response.send(\"Nhận được một yêu cầu GET xem trang chủ.\");\r\n});\r\n\r\napp.post(\"/login\", function(request, response) {\r\n   response.send(\"Nhận được một yêu cầu POST thông tin người dùng.\");\r\n});\r\n\r\napp.put(\"/post\", function(request, response) {\r\n   response.send(\"Nhận được một yêu cầu PUT nội dung bài viết.\");\r\n});\r\n\r\napp.delete(\"/post\", function(request, response) {\r\n   response.send(\"Nhận được một yêu cầu DELETE xóa một bài viêt.\");\r\n});\r\n```\r\n\r\n## Sử dụng Path định tuyến\r\n\r\nNói riêng về thành phần `path` trong câu lệnh định tuyến cơ bản. Đây là một phần ứng dụng của các biểu thức thường thị `regexp` mà chúng ta đã biết. ExpressJS hỗ trợ một số biểu thức chuỗi cơ bản là `?`, `+`, `*`, và `()`.\r\n\r\n```app.js\r\napp.get(\"/ab?cd\", function(request, response) {\r\n   // tiếp nhận cả /abcd và /acd\r\n});\r\n```\r\n\r\n```app.js\r\napp.get(\"/ab+cd\", function(request, response) {\r\n   // ký tự b có thể lặp một hoặc nhiều lần\r\n});\r\n```\r\n\r\n```app.js\r\napp.get(\"*\", function(request, response) {\r\n   // tiếp nhận tất cả các yêu cầu\r\n});\r\n```\r\n\r\n```app.js\r\napp.get(\"/a(bc)?d\", function(request, response) {\r\n   // tiếp nhận /abcd và /ad\r\n});\r\n```\r\n\r\nVà tất nhiên là chúng ta cũng có thể sử dụng một `regexp` ở đây thay cho một chuỗi mô tả `path`. Nhưng có lẽ bấy nhiêu là đã tạm đủ cho mục đích tạo blog đơn giản mà chúng ta đang hướng đến rồi. :D\r\n\r\n## Sử dụng Path chứa các tham số\r\n\r\nCác tham số định tuyến về cơ bản là các thành phần của URL được đặt tên trong code để lưu lại các giá trị ở các vị trí tương ứng khi yêu cầu được gửi tới. Các tham số được viết giống như các thành phần của `path` nhưng được biểu thị với ký tự `:` ở phía trước.\r\n\r\n```app.js\r\napp.get(\"/post/:postId/author/:authorId\", function(request, response) {\r\n   response.send(request.params);\r\n});\r\n\r\n// path giả định: \"/post/0001/author/0001\"\r\n// request.params: { \"postId\": \"0001\", \"authorId\": \"0001\" }\r\n\r\napp.get(\"/post/:postId-:authorId\",  function(request, response) {\r\n   response.send(request.params);\r\n});\r\n\r\n// path giả định \"/post/0001-0001\"\r\n// request.params: { \"postId\": \"0001\", \"authorId\": \"0001\" }\r\n```\r\n\r\n## Các hàm xử lý yêu cầu\r\n\r\nĐối với mỗi `route`, chúng ta có thể gắn một hoặc nhiều hàm xử lý yêu cầu ở dạng mảng. Trong trường hợp sử dụng nhiều hàm xử lý yêu cầu cho một `route`, các hàm xử lý được gắn trước sẽ có thể có thêm tham số thứ ba là `next` để chuyển tiếp quyền xử lý cho hàm tiếp theo `next()` hoặc chuyển sang `route` tiếp theo bằng `next(\"route\")`.\r\n\r\n```app.js\r\nconst authencicate = function(req, res, next) {\r\n   console.log(\"Kiểm tra phiên đăng nhập hợp lệ.\");\r\n   next(); // chuyển tới xử lý handlePostEdit\r\n};\r\n\r\nconst handlePostEdit = function(req, res) {\r\n   console.log(\"Truy vấn dữ liệu và trả về view edit\");\r\n};\r\n\r\napp.get('/post/:postId/edit', [authencicate, handlePostEdit]);\r\n```\r\n\r\n## Phương thức app.route()\r\n\r\nTrong trường hợp có nhiều phương thức gửi tới cùng một điểm `endpoint` thì chúng ta có thể sử dụng phương thức `app.route()` để viết các hàm xử lý ở dạng nối tiếp.\r\n\r\n```app.js\r\napp.route('/post')\r\n   .all(function(req, res, next) {\r\n      // các bước xử lý chung trước khi\r\n      // phân loại phương thức gửi đến\r\n      next();\r\n   })\r\n   .get(function(req, res) {\r\n      res.send('Get a post')\r\n   })\r\n   .post(function(req, res) {\r\n      res.send('Add a post')\r\n   })\r\n   .put(function(req, res) {\r\n      res.send('Update the post')\r\n   });\r\n```\r\n\r\n## Sử dụng các object định tuyến Router\r\n\r\nViệc kiến trúc một code `server` với nhiều tuyến xử lý, về mặt tổng quan cũng không khác nhiều so với viết một phần mềm `console` nhỏ. Chúng ta chắc chắn sẽ luôn muốn duy trì phần khung chính `main` của chương trình thật gọn gàng và chỉ tập trung mô tả tổng quan các bước xử lý.\r\n\r\nChính vì vậy nên ExpressJS có cung cấp thêm cho chúng ta một công cụ để thực hiện việc phân tách các hàm xử lý yêu cầu ra khỏi phần thân chương trình chính. Đó là các [object định tuyến Router](https://expressjs.com/en/4x/api.html#router) - có các phương thức và cú pháp điều hướng hoàn toàn tương đồng với `app`.\r\n\r\n```app.js\r\nconst express = require(\"express\");\r\nconst app = express();\r\n\r\nconst homeRouter = require(\"./route/home\");\r\nconst loginRouter = require(\"./route/login\");\r\nconst postRouter = require(\"./route/post\");\r\n\r\napp.use(\"/\", homeRouter);\r\napp.use(\"/login\", loginRouter);\r\napp.use(\"/post\", postRouter);\r\n\r\napp.listen(3000);\r\n```\r\n\r\n```route/home.js\r\nconst express = require(\"express\");\r\nconst router = express.Router();\r\n\r\nrouter.get(\"/\", function(req, res) {\r\n   res.send(\"Nhận được yêu cầu GET xem trang chủ.\");\r\n});\r\n\r\nmodule.exports = router;\r\n```\r\n\r\n```route/login.js\r\nconst express = require(\"express\");\r\nconst router = express.Router();\r\n\r\nrouter.post(\"/\", function(req, res) {\r\n   res.send(\"Nhận được yêu cầu POST thông tin đăng nhập.\");\r\n});\r\n\r\nmodule.exports = router;\r\n```\r\n\r\n```route/post.js\r\nconst express = require(\"express\");\r\nconst router = express.Router();\r\n\r\nrouter.get(\"/\", function(req, res) {\r\n   res.send(\"Nhận được yêu cầu GET xem một bài viết.\");\r\n});\r\n\r\nmodule.exports = router;\r\n```\r\n\r\nKhi sử dụng `router`, chúng ta cần lưu ý rằng `path` dùng cho các phương thức của `router` sẽ là các đường dẫn tương đối, nối tiếp với `path` được sử dụng ở `app` khi thực hiện thao tác gắn `router` bằng `app.use()`.\r\n\r\nNói tới `app.use()`, ở đây chúng ta lại được gặp thêm một khái niệm mới được gọi là `plug-in` xử lý trung gian - hay `middleware`. Tuy nhiên để duy trì trọng tâm bài viết  xoay quanh nội dung giới thiệu các thao tác cơ bản để điều hướng yêu cầu, chúng ta sẽ để dành `middleware` cho bài viết tiếp theo. :D\r\n\r\n[[ExpressJS] Bài 4 - Sử dụng Middleware](/article/view/0072/expressjs-bài-4---sử-dụng-middleware)"
}
